"undefined"!=typeof module&&module.exports&&(this.later=require("later")),schedule=function(e){"use strict";function r(e){return e.id}function n(e){return e.available}function t(e){return e.isNotReservable||!1}function a(e){return e.id}function i(e){return e.duration}function s(e){return e.available}function u(e){return e.resources}function o(e){return e.dependsOn}function l(e){return e.minSchedule}function c(e){return e.priority}var d={version:"0.6.3"};if(!e)throw new Error("Laterjs must be included before Schedulejs.");return Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var r=Object(this),n=r.length>>>0;if(0===n)return-1;var t=0;if(arguments.length>1&&((t=Number(arguments[1]))!=t?t=0:0!=t&&t!=1/0&&t!=-1/0&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=n)return-1;for(var a=t>=0?t:Math.max(n-Math.abs(t),0);a<n;a++)if(a in r&&r[a]===e)return a;return-1}),d.date={},d.date.UTC=function(){e.date.UTC()},d.date.localTime=function(){e.date.localTime()},d.functor=function(e){return"function"==typeof e?e:function(){return e}},d.memoizedRangeFn=function(e){var r={};return function(n){if(!r[n]){var t=e(1,n);r[n]=[t[0]?t[0].getTime():41024448e5,t[1]?t[1].getTime():41024448e5]}return r[n]}},d.sort={},d.sort.tasks=function(e,r){r.sort(function(r,n){var t=e.tasks[r],a=e.tasks[n];return a.priority&&(!t.priority||a.priority>t.priority)?-1:t.priority&&(!a.priority||t.priority>a.priority)?1:e.tasks[n].floatAmt>e.tasks[r].floatAmt})},d.resources=function(){function e(e){for(var r=[],n=d.functor(a),t=d.functor(i),u=d.functor(s),o=0,l=e.length;o<l;o++){var c=e[o],f=n.call(this,c,o),h=t.call(this,c,o),v=u.call(this,c,o);r.push({id:f,available:h,isNotReservable:v})}return r}var a=r,i=n,s=t;return e.id=function(r){return arguments.length?(a=r,e):a},e.available=function(r){return arguments.length?(i=r,e):i},e.isNotReservable=function(r){return arguments.length?(s=r,e):s},e},d.tasks=function(){function e(e){for(var a=[],i=d.functor(r),s=d.functor(n),u=d.functor(t),o=d.functor(f),l=d.functor(h),c=d.functor(v),g=d.functor(p),y=0,b=e.length;y<b;y++){var m=e[y],x={id:i.call(this,m,y),duration:s.call(this,m,y),available:u.call(this,m,y),resources:o.call(this,m,y),dependsOn:l.call(this,m,y),minSchedule:c.call(this,m,y),priority:g.call(this,m,y)};a.push(x)}return a}var r=a,n=i,t=s,f=u,h=o,v=l,p=c;return e.id=function(n){return arguments.length?(r=n,e):r},e.duration=function(r){return arguments.length?(n=r,e):n},e.available=function(r){return arguments.length?(t=r,e):t},e.resources=function(r){return arguments.length?(f=r,e):f},e.dependsOn=function(r){return arguments.length?(h=r,e):h},e.minSchedule=function(r){return arguments.length?(v=r,e):v},e.priority=function(r){return arguments.length?(p=r,e):p},e},d.dependencyGraph=function(e){function r(e,n,t){for(var a=0,s=n.length;a<s;a++){var u=e.tasks[n[a]],o=u.dependsOn;u.depth=!u.depth||t>u.depth?t:u.depth,e.depth=t>e.depth?t:e.depth,i(o)||r(e,o,u.depth+1)}}function n(e,r,t,s){a(r,t,s);for(var u=0,o=t.length;u<o;u++){var l=t[u],c=e.tasks[l],d=c.dependsOn,f=r[l];!c.earlyFinish&&(i(d)||f&&f[0]===d.length)&&(c.earlyStart=f[1],c.earlyFinish=f[1]+c.duration,i(c.requiredBy)||n(e,r,c.requiredBy,c.earlyFinish))}}function t(e,r,n,s){a(r,n,s,!0);for(var u=0,o=n.length;u<o;u++){var l=n[u],c=e.tasks[l],d=c.requiredBy,f=r[l];(i(d)||f&&f[0]===d.length)&&(c.lateStart=f[1]-c.duration,c.lateFinish=f[1],c.floatAmt=c.lateFinish-c.earlyFinish,i(c.dependsOn)||t(e,r,c.dependsOn,c.lateStart))}}function a(e,r,n,t){for(var a=t?function(e,r){return r>e}:function(e,r){return e>r},i=0,s=r.length;i<s;i++){var u=r[i];e[u]?(e[u][0]=e[u][0]+1,e[u][1]=a(n,e[u][1])?n:e[u][1]):e[u]=[1,n]}}function i(e){return!e||0===e.length}return function(e){for(var a={tasks:{},roots:[],leaves:[],resources:[],depth:0,end:0},s=0,u=e.length;s<u;s++){var o=e[s];a.tasks[o.id]={id:o.id,duration:o.duration,priority:o.priority,schedule:o.schedule,minSchedule:o.minSchedule,dependsOn:o.dependsOn,resources:o.resources}}return function(e){for(var r in e.tasks){var n=e.tasks[r];if(!i(n.resources))for(var t=0,a=n.resources.length;t<a;t++){var s=n.resources[t];-1===e.resources.indexOf(s)&&e.resources.push(s)}}}(a),function(e){for(var r in e){var n=e[r],t=n.dependsOn;if(!i(t))for(var a=0,s=t.length;a<s;a++){var u=e[t[a]];(u.requiredBy||(u.requiredBy=[])).push(n.id)}}}(a.tasks),function(e){for(var r in e.tasks){var n=e.tasks[r];i(n.dependsOn)&&e.roots.push(n.id),i(n.requiredBy)&&e.leaves.push(n.id)}}(a),r(a,a.leaves,0),a.depth+=1,n(a,{},a.roots,0),function(e,r){for(var n=0,t=r.length;n<t;n++){var a=e.tasks[r[n]].earlyFinish;e.end=a>e.end?a:e.end}}(a,a.leaves),t(a,{},a.leaves,a.end),a}(e)},d.resourceManager=function(r,n){function t(r,n,t){var a=JSON.parse(JSON.stringify(n.available||o)),i=d.memoizedRangeFn(e.schedule(a).nextRange);r[n.id]={schedule:a,next:i,nextAvail:i(t)}}function a(r,n,t,a){var u,o=[],c={},d=50;for(i(r,n,o,c);!(u=function(r,n,t){for(var a,i,s={success:!1},u=[],o=0,c=r.length;o<c;o++){var d=r[o],f=d.range;(function(e){return"_"===e.id[0]})(d)||u.push(d.id),a=!a||f[0]>a?f[0]:a,i=!i||f[1]<i?f[1]:i}var h=(i-a)/e.MIN;(h>=n||h>=t)&&(s=function(r,n,t){var a=n+t*e.MIN,i={resources:r,start:n,end:a,duration:t,success:!0};return function(r,n,t){for(var a=0,i=r.length;a<i;a++){var s=l[r[a]];s.isNotReservable||(n!==s.nextAvail[0]&&(s.schedule.exceptions||(s.schedule.exceptions=[]),s.schedule.exceptions.push({fd_a:[n],fd_b:[t]}),s.next=d.memoizedRangeFn(e.schedule(s.schedule).nextRange),t=s.nextAvail[0]),s.nextAvail=s.next(t))}}(r,n,a),i}(u,a,h=t&&h>t?t:h));return s}(o,t,a)).success&&--d;)s(o,function(e){for(var r,n=0,t=e.length;n<t;n++){var a=e[n].range[1];r=!r||a<r?a:r}return r}(o),c);return u.delays=c,u}function i(e,r,n,t){for(var a=0,s=e.length;a<s;a++){var o=e[a];if(Array.isArray(o)){var c=[],d={};i(o,r,c,d);var f=function(e){var r,n;for(var t in e){var a=e[t].available;(!r||a<r)&&(r=a,n=t)}return n}(d);f&&(t[f]=d[f]);var h={subRanges:c};u(h),n.push(h)}else{var v=l[o],p=v.nextAvail[0]>=r?v.nextAvail:v.next(r);p[0]>r&&"_proj"!==o&&(t[o]={needed:r,available:p[0]}),n.push({id:o,range:p})}}}function s(e,r,n){for(var t=0,a=e.length;t<a;t++){var i=e[t];i.range[1]>r||(i.subRanges?(s(i.subRanges,r,{}),u(i)):(i.range=l[i.id].next(r),"_proj"===i.id||n[i.id]||(n[i.id]={needed:r,available:i.range[0]})))}}function u(e){for(var r,n,t=0,a=e.subRanges.length;t<a;t++){var i=e.subRanges[t];(!r||i.range[0]<n[0])&&(r=i.id,n=i.range)}e.id=r,e.range=n}var o={schedules:[{fd_a:[n.getTime()]}]},l=function(e,r){var n={};if(e)for(var a=0,i=e.length;a<i;a++)t(n,e[a],r);return n}(r,n);return{getResource:function(e){return l[e]},addResource:function(e,r,n){for(var a=0,i=e.length;a<i;a++){var s="object"!=typeof e[a]?{id:r+e[a]}:{id:r+e[a].id,available:e[a].available,isNotReservable:e[a].isNotReservable};l[s.id]||t(l,s,n)}},makeReservation:function(e,r,n,t){return r=r?new Date(r):new Date,a(e,r.getTime(),n||1,t)},optimize:function(r){for(var n in l){var t=l[n];if(t.schedule.exceptions){var a=t.schedule.exceptions;t.schedule.exceptions=[];for(var i=0,s=a.length;i<s;i++)(!a[i].fd_b||a[i].fd_b>r)&&t.schedule.exceptions.push(a[i]);t.next=d.memoizedRangeFn(e.schedule(t.schedule).nextRange)}t.nextAvail[0]<r&&(t.nextAvail=t.next(r))}}}},d.create=function(r,n,t,a){function i(r,n){for(var t=0,a=r.length;t<a;t++){var s=l[r[t]],o=u.tasks[r[t]].dependsOn;s&&(s.lateFinish=n,s.floatAmt=(s.lateFinish-s.earlyFinish)/e.MIN,o&&i(o,s.earlyStart))}}if(!Array.isArray(r))throw new Error("Tasks are required and must be passed in as an array.");if(n&&!Array.isArray(n))throw new Error("Resources must be passed in as an array.");var s=a?new Date(a):new Date;if(!s||!s.getTime())throw new Error("Invalid start date specified.");var u=d.dependencyGraph(r),o=d.resourceManager(n,s),l={};return function(){var e,n=[];return o.addResource(u.resources,"",s),o.addResource([{id:"_proj",available:t}],"",s),o.addResource(r,"_task",s),function(e){for(var r=e.slice(0),n={},t=0,a=e.length;t<a;t++)n[e[t]]=[0,s.getTime()];for(;r.length;){d.sort.tasks(u,r);var i=u.tasks[r.pop()],c=n[i.id][1],f=function(e,r){for(var n=["_proj","_task"+e.id],t=e.resources?n.concat(e.resources):n,a=e.duration,i=r,s={schedule:[],duration:e.duration};a;){var u=o.makeReservation(t,i,e.minSchedule||1,a);if(!u.success)return;s.earlyStart=s.earlyStart||u.start,s.schedule.push(u),a-=u.duration,i=u.end}return s.earlyFinish=i,l[e.id]=s,i}(i,c);f&&i.requiredBy&&(function(e,r,n,t){for(var a=0,i=n.length;a<i;a++){var s=n[a],o=u.tasks[s].dependsOn,l=r[s]||(r[s]=[0,0]);l[0]+=1,l[1]=t>l[1]?t:l[1],(!o||l[0]>=o.length)&&e.push(s)}}(r,n,i.requiredBy,f),o.optimize(function(e){var r;for(var n in e)(!r||r>e[n][1])&&(r=e[n][1]);return r}(n)))}}(u.roots),e=function(e,r){for(var n,t,a=0,i=e.length;a<i;a++){var s=l[e[a].id];s?(n=!n||s.earlyStart<n?s.earlyStart:n,t=!t||s.earlyFinish>t?s.earlyFinish:t):r.push(e[a].id)}return[n,t]}(r,n),i(u.leaves,e[1]),{scheduledTasks:l,failedTasks:n.length?n:null,success:0===n.length,start:e[0],end:e[1]}}()},d}(this.later);